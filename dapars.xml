<tool id="dapars" name="dapars" version="0.2.0">
    <description>infer de-novo alternative polyadenylation from rna-seq</description>
    <requirements>
        <requirement type="package" version="1.9">numpy</requirement>
        <requirement type="package" version="0.14">scipy</requirement>
        <requirement type="package" version="1.4">matplotlib</requirement>
        <requirement type="package" version="0.7.5">tabulate</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command interpreter="python"><![CDATA[
        dapars.py -c $controls
        -t
        #for $t in $treatments:
            "$t"
        #end for
        -u "$utr" 
        -o "$apa_sites"
        -cpu \${GALAXY_SLOTS:-4}
        --coverage_threshold "$coverage_threshold"
        --search_start "$search_start"
        #if $make_breakpoint:
            -b "$breakpoint_bed"
        #end if
        #if $make_html:
            -p "$html_file.files_path"
            -html "$html_file"
        #end if
    ]]></command>
    <inputs>
        <param type="data" name="utr" format="gtf" label="GFF file containing 3prime UTRs" help="featureType of the UTRs
        must be UTR, and the attribute group must have geneid in first position."/>
        <param type="data" name="controls" format="bam,sam" multiple="True" label="Control alignment files" help="Select control alignment files" />
        <param type="data" name="treatments" format="bam,sam" multiple="True" label="Treatment alignment files" help="Select treatment alignment files" />
        <param type="integer" name="search_start" value="100" optional="False" min="1" label="Search start" help="Search start in nucleotides downstream of the start of the UTR. Necessary to correct for proximal drops in coverage. Select 200 for humans. Genomes with short UTRs may require more prpximal search start points."/>
        <param type="float" name="coverage_threshold" value="20" optional="False" label="Coverage threshold" help="Skip the analysis of UTRs whose mean coverage is below the Coverage Threshold in any of the alignment files."/>
        <param name="make_breakpoint" type="boolean" checked="False" label="Output bedfile with breakpoint positions?"/>
        <param name="make_html" type="boolean" checked="False" label="Output HTML table with plot for every UTR?"/>
    </inputs>
    <outputs>
        <data name="apa_sites" format="tabular" />
        <data name="breakpoint_bed" format="bed6">
            <filter>(make_breakpoint == True)</filter>
        </data>
        <data name="html_file" format="html">
            <filter>(make_html == True)</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="utr" value="example.gtf"></param>
            <param name="controls" value="c1.bam,c2.bam,c3.bam"></param>
            <param name="treatments" value="t1.bam,t2.bam,t3.bam"></param>
            <param name="coverage_threshold" value="5"></param>
            <param name="search_start" value="1"></param>
            <param name="make_breakpoint" value="True"></param>
            <param name="make_html" value="True"></param>
            <output name="apa_sites" file="dapars.tab"></output>
            <output name="breakpoint_bed" file="breakpoint.bed"></output>
        </test>
    </tests>
    <help><![CDATA[
        DaPars works on RNAseq aligment files to find drops of coverage within UTRs. The coverage is then divided into
        proximal and distal, and the ratio is calculated for each sample.
    ]]></help>
    <citations>
        <citation type="doi">10.1038/ncomms6274</citation>
    </citations>
</tool>
